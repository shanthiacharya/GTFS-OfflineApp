function init(){indexedDBHelper.open().then(function(){},function(e){alert(e)}),spinner_div=$("#spinner").get(0)}function addgtfsstations(){var e=document.getElementById("departurelist"),t=e.options[e.selectedIndex];departure=t.value;var r=document.getElementById("arrivallist"),i=r.options[r.selectedIndex];return arrival=i.value,indexedDBHelper.addgtfsstations(departure,arrival).then(function(){},function(e){alert(e)}),!1}function refreshGTFSStations(){bartgtfsDB.fetchTodos(function(e){for(var t=0;t<e.length;t++){e[e.length-1-t]}})}function showTrains(e,t){null==spinner?spinner=new Spinner(opts).spin(spinner_div):spinner.spin(spinner_div);var r;Papa.parse("../data/stop_times.txt",{delimiter:",",download:!0,header:!0,complete:function(e){r=e.data;var t=r.filter(getStopsbyTimeofDay);console.log(t),console.log(t.length);var i=t.filter(matchArrival),a=t.filter(matchDeparture);getListofTrains(a,i),spinner.stop(spinner_div)}})}function parseMillisecondsIntoReadableTime(e){var t=e/36e5,r=Math.floor(t),i=r>9?r:"0"+r,a=60*(t-r),n=Math.floor(a),o=n>9?n:"0"+n,s=60*(a-n),l=Math.floor(s),d=l>9?l:"0"+l;return i+":"+o+":"+d}function getListofTrains(e,t){var r=[],a=[],n=[];new Date,new Date;for(i=0;i<e.length;i++)console.log(e[i].stop_id),-1===n.indexOf(e[i].stop_headsign)&&n.push(e[i].stop_headsign);for(console.log(n),i=0;i<n.length;i++){t.filter(function(e){return e.stop_headsign==n[i]?(r.push(e),!0):!1})}for(i=0;i<e.length;i++){r.filter(function(t){return t.trip_id==e[i].trip_id?(a.push(t),!0):!1})}var o=$("#stoptimes_List").html();$("#listoftrains").html(_.template(o,{stoptimestabledata:a})),loadstoptimesDataTable();var o=$("#departuretimes_List").html();$("#departuretimetablelist").html(_.template(o,{deptimestabledata:e})),loaddeparturetimesDataTable()}function matchDeparture(e,t,r){return departure?e.stop_id==departure:void 0}function matchArrival(e,t,r){return console.log("Arrival :"+arrival),arrival?e.stop_id==arrival:void 0}function getStopsbyTimeofDay(e,t,r){var i=new Date,a=new Date,n=(new Date,!1),o=!1,s=i.getHours(),l=i.getMinutes(),d=i.getSeconds();i.setHours(s,l,d);var p=String(e.arrival_time),u=p.split(":");a.setHours(u[0],u[1],u[2]);var c=i.getDay();return 0==c?n=!0:6==c&&(o=!0),n?-1!=e.trip_id.indexOf("SUN")&&a>=i&&(e.stop_id==departure||e.stop_id==arrival):o?-1!=e.trip_id.indexOf("SAT")&&a>=i&&(e.stop_id==departure||e.stop_id==arrival):-1==e.trip_id.indexOf("SUN")&&-1==e.trip_id.indexOf("SAT")&&a>=i&&(e.stop_id==departure||e.stop_id==arrival)}function loadstoptimesDataTable(){$("#stoptimes-table").dataTable({bAutoWidth:!1,oLanguage:{sLengthMenu:"_MENU_ records per page"},iDisplayLength:25,bPaginate:!0,bFilter:!0,bInfo:!0,aaSorting:[[0,"asc"]],aoColumns:[{sWidth:"10%"},{sWidth:"30%"},{sWidth:"30%"},{sWidth:"10%"},{sWidth:"10%"},{sWidth:"50%"}],initComplete:function(e,t){$("#stoptimes-table").show()}})}function loaddeparturetimesDataTable(){$("#departure-table").dataTable({bAutoWidth:!1,oLanguage:{sLengthMenu:"_MENU_ records per page"},iDisplayLength:25,bPaginate:!0,bFilter:!0,bInfo:!0,responsive:!0,aaSorting:[[0,"asc"]],aoColumns:[{sWidth:"10%"},{sWidth:"30%"},{sWidth:"30%"},{sWidth:"10%"},{sWidth:"10%"},{sWidth:"50%"}],initComplete:function(e,t){$("#departure-table").show()}})}var form=document.getElementById("searchtrainsform"),trainarray=[],departure,arrival,opts={lines:11,length:15,width:10,radius:30,corners:1,rotate:0,direction:1,color:"#000",speed:.6,trail:60,shadow:!1,hwaccel:!1,className:"spinner",zIndex:2e9,top:"auto",left:"auto"},spinner=null,spinner_div=0;window.addEventListener("DOMContentLoaded",init,!1),form.addEventListener("submit",function(e){console.log("Inside Submit");var t=document.getElementById("departurelist"),r=t.options[t.selectedIndex];departure=r.value,console.log(r),console.log("Departure: "+r.value);var i=document.getElementById("arrivallist"),a=i.options[i.selectedIndex];if(arrival=a.value,console.log(a),console.log("Arrival: "+a.value),departure==arrival){var n="<div id='errorMsg' class='alert alert-danger'> <strong>Departure and arrival cannot be the same station. Please fix it and try again </strong></div>";$(form).after(n),e.preventDefault()}else $("#errorMsg").hide(),addgtfsstations(),showTrains(departure,arrival),e.preventDefault()}),"serviceWorker"in navigator&&navigator.serviceWorker.register("./sw.js").then(function(){console.log("Service Worker Registered")});