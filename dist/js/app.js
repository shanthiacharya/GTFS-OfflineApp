function init(){indexedDBHelper.open().then(function(){},function(e){alert(e)}),spinner_div=$("#spinner").get(0)}function addgtfsstations(){var e=document.getElementById("departurelist"),t=e.options[e.selectedIndex];departure=t.value;var i=document.getElementById("arrivallist"),a=i.options[i.selectedIndex];return arrival=a.value,indexedDBHelper.addgtfsstations(departure,arrival).then(function(){},function(e){alert(e)}),!1}function refreshGTFSStations(){bartgtfsDB.fetchTodos(function(e){for(var t=0;t<e.length;t++){e[e.length-1-t]}})}function showTrains(e,t){null==spinner?spinner=new Spinner(opts).spin(spinner_div):spinner.spin(spinner_div);var i;Papa.parse("../data/stop_times.txt",{delimiter:",",download:!0,header:!0,complete:function(e){i=e.data;var t=i.filter(getStopsbyTimeofDay);console.log(t),console.log(t.length);var a=t.filter(matchArrival),r=t.filter(matchDeparture);getListofTrains(r,a),spinner.stop(spinner_div)}})}function parseMillisecondsIntoReadableTime(e){var t=e/36e5,i=Math.floor(t),a=i>9?i:"0"+i,r=60*(t-i),n=Math.floor(r),o=n>9?n:"0"+n,s=60*(r-n),l=Math.floor(s),d=l>9?l:"0"+l;return a+":"+o+":"+d}function getListofTrains(e,t){var a=[],r=[],n=[];new Date,new Date;for(i=0;i<e.length;i++)console.log(e[i].stop_id),-1===n.indexOf(e[i].stop_headsign)&&n.push(e[i].stop_headsign);for(console.log(n),i=0;i<n.length;i++){t.filter(function(e){return e.stop_headsign==n[i]?(a.push(e),!0):!1})}for(i=0;i<e.length;i++){a.filter(function(t){return t.trip_id==e[i].trip_id?(r.push(t),!0):!1})}var o=$("#stoptimes_List").html();$("#listoftrains").html(_.template(o,{stoptimestabledata:r})),loadstoptimesDataTable();var o=$("#departuretimes_List").html();$("#departuretimetablelist").html(_.template(o,{deptimestabledata:e})),loaddeparturetimesDataTable()}function matchDeparture(e,t,i){return departure?e.stop_id==departure:void 0}function matchArrival(e,t,i){return console.log("Arrival :"+arrival),arrival?e.stop_id==arrival:void 0}function getStopsbyTimeofDay(e,t,i){var a=new Date,r=new Date,n=(new Date,!1),o=!1,s=a.getHours(),l=a.getMinutes(),d=a.getSeconds();a.setHours(s,l,d);var p=String(e.arrival_time),u=p.split(":");r.setHours(u[0],u[1],u[2]);var c=a.getDay();return 0==c?n=!0:6==c&&(o=!0),n?-1!=e.trip_id.indexOf("SUN")&&r>=a&&(e.stop_id==departure||e.stop_id==arrival):o?-1!=e.trip_id.indexOf("SAT")&&r>=a&&(e.stop_id==departure||e.stop_id==arrival):-1==e.trip_id.indexOf("SUN")&&-1==e.trip_id.indexOf("SAT")&&r>=a&&(e.stop_id==departure||e.stop_id==arrival)}function loadstoptimesDataTable(){$("#stoptimes-table").dataTable({bAutoWidth:!1,oLanguage:{sLengthMenu:"_MENU_ records per page"},iDisplayLength:25,bPaginate:!0,bFilter:!0,bInfo:!0,responsive:!0,aaSorting:[[0,"asc"]],aoColumns:[{sWidth:"30%"},{sWidth:"30%"},{sWidth:"10%"},{sWidth:"10%"},{sWidth:"50%"}],initComplete:function(e,t){$("#stoptimes-table").show()}})}function loaddeparturetimesDataTable(){$("#departure-table").dataTable({bAutoWidth:!1,oLanguage:{sLengthMenu:"_MENU_ records per page"},iDisplayLength:25,bPaginate:!0,bFilter:!0,bInfo:!0,responsive:!0,aaSorting:[[0,"asc"]],aoColumns:[{sWidth:"30%"},{sWidth:"30%"},{sWidth:"10%"},{sWidth:"10%"},{sWidth:"50%"}],initComplete:function(e,t){$("#departure-table").show()}})}var form=document.getElementById("searchtrainsform"),trainarray=[],departure,arrival,opts={lines:11,length:15,width:10,radius:30,corners:1,rotate:0,direction:1,color:"#000",speed:.6,trail:60,shadow:!1,hwaccel:!1,className:"spinner",zIndex:2e9,top:"auto",left:"auto"},spinner=null,spinner_div=0;window.addEventListener("DOMContentLoaded",init,!1),form.addEventListener("submit",function(e){console.log("Inside Submit");var t=document.getElementById("departurelist"),i=t.options[t.selectedIndex];departure=i.value,console.log(i),console.log("Departure: "+i.value);var a=document.getElementById("arrivallist"),r=a.options[a.selectedIndex];if(arrival=r.value,console.log(r),console.log("Arrival: "+r.value),departure==arrival){var n="<div id='errorMsg' class='alert alert-danger'> <strong>Departure and arrival cannot be the same station. Please fix it and try again </strong></div>";$(form).after(n),e.preventDefault()}else $("#errorMsg").hide(),addgtfsstations(),showTrains(departure,arrival),e.preventDefault()});